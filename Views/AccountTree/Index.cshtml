@using System.Globalization
@model ASP.Net_Core_MVC.Full.Models.AccountTreeIndexVm

@{
    ViewData["Title"] = "شجرة الحسابات";
    ViewData["Direction"] = "rtl";
}

@section styles
{
    <!-- jstree css -->
    <link href="~/plugins/jstree/style.min.css" rel="stylesheet" type="text/css">
    
    <style>
        /* Popup menu card styles */
        #popupMenuModal .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border: 1px solid rgba(0, 0, 0, 0.125);
        }
        
        #popupMenuModal .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        
        #popupMenuModal .card i {
            font-size: 2rem;
        }
        
        #popupMenuModal .card .btn {
            transition: all 0.2s ease-in-out;
        }
        
        #popupMenuModal .card .btn:hover {
            transform: scale(1.05);
        }
        
        /* Modal header styling - using project's primary color */
        .modal-header {
            background-color: #1ab394; /* Project's primary color */
            color: white;
            border-bottom: 1px solid #16987e;
        }
        
        /* Modal title styling */
        .modal-header .modal-title {
            font-weight: 500;
            color: white;
        }
        
        /* Close button styling for modal headers */
        .modal-header .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
        
        /* Modal footer styling - using a lighter shade */
        .modal-footer {
            background-color: #f0f8f8; /* Light teal background */
            border-top: 1px solid #d1e8e8;
        }
        
        /* Primary buttons in modals */
        .modal-footer .btn-primary {
            background-color: #1ab394;
            border-color: #1ab394;
        }
        
        .modal-footer .btn-primary:hover {
            background-color: #16987e;
            border-color: #16987e;
        }
        
        /* View account modal specific styles */
        #viewAccountModal .form-control-plaintext {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            min-height: 38px;
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        
        /* Dark mode adjustments for view modal */
        [data-bs-theme="dark"] #viewAccountModal .form-control-plaintext {
            background-color: #272832;
            border-color: #293036;
            color: #aab8c5;
        }
        
        /* Consistent button styling across all modals */
        .btn-info {
            background-color: #23c6c8;
            border-color: #23c6c8;
        }
        
        .btn-info:hover {
            background-color: #1ea8aa;
            border-color: #1ea8aa;
        }
        
        /* Dark mode button adjustments */
        [data-bs-theme="dark"] .btn-info {
            background-color: #23c6c8;
            border-color: #23c6c8;
        }
        
        [data-bs-theme="dark"] .btn-info:hover {
            background-color: #1ea8aa;
            border-color: #1ea8aa;
        }
        
        /* Tree view container */
        #account-tree {
            min-height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        
        /* تعديل الجدول لإزالة المسافة بين الرأس والمحتوى */
        .table-bordered thead th {
            border-bottom-width: 1px;
        }
        
        .table-bordered tbody tr:first-child td {
            border-top: none;
        }
        
        .table {
            margin-bottom: 0;
        }
        
        /* Select all checkboxes styling */
        .form-check-input:checked {
            background-color: #1ab394;
            border-color: #1ab394;
        }
        
        /* Alert styling for better visibility */
        .alert-warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        /* Dark mode alert adjustments */
        [data-bs-theme="dark"] .alert-warning {
            background-color: #664d03;
            border-color: #7d5f04;
            color: #ffecb5;
        }
        
        [data-bs-theme="dark"] .alert-danger {
            background-color: #721c24;
            border-color: #842029;
            color: #f8d7da;
        }
    </style>
}

<!-- Filter toggle button -->
<div class="mb-2">
    <button id="toggleFilters" type="button" class="btn btn-primary">
        <i class="ti ti-filter-off me-1"></i><span id="toggleFiltersText">إظهار الفلترة</span>
    </button>
</div>

<!-- Filter section -->
<div class="card mb-3" id="filterSection" style="display: none;">
    <div class="card-body p-2">
        <!-- Filter row -->
        <div class="row g-2 mb-2">
            <div class="col">
                <input type="text" class="form-control form-control-sm" placeholder="اسم الحساب" id="filter-name">
            </div>
            <div class="col">
                <input type="text" class="form-control form-control-sm" placeholder="رقم الهاتف" id="filter-phone">
            </div>
            <div class="col">
                <input type="text" class="form-control form-control-sm" placeholder="الحساب" id="filter-account">
            </div>
            <div class="col">
                <button type="button" class="btn btn-secondary btn-sm" id="resetFilters">إعادة تعيين</button>
                <button type="button" class="btn btn-primary btn-sm" id="applyFilters">تطبيق</button>
            </div>
        </div>
    </div>
</div>

<!-- Action buttons -->
<div class="mb-3">
    <div class="d-flex gap-2 flex-wrap">
        <a href="#" class="btn btn-sm btn-outline-danger" title="حذف">
            <i class="ti ti-trash"></i>
        </a>
        <a href="#" class="btn btn-sm btn-outline-success" title="إضافة" data-bs-toggle="modal" data-bs-target="#accountTreeAccountsModal">
            <i class="ti ti-plus"></i>
        </a>
        <a href="#" class="btn btn-sm btn-outline-primary" title="تعديل" id="topEditButton">
            <i class="ti ti-pencil"></i>
        </a>
        <a href="#" class="btn btn-sm btn-outline-info" title="مشاهدة" id="topViewButton">
            <i class="ti ti-eye"></i>
        </a>
        <!-- New Popup Menu Button -->
        <a href="#" class="btn btn-sm btn-outline-dark" title="قائمة الإجراءات" data-bs-toggle="modal" data-bs-target="#popupMenuModal">
            <i class="ti ti-menu-2"></i>
        </a>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <div class="d-flex align-items-center">
            <h5 class="card-title mb-0 fw-bold">@ViewData["Title"]</h5>
            <div class="me-auto">
                <!-- Refresh button -->
                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" id="refreshBtn" title="تحديث">
                    <i class="ti ti-refresh"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="accounts-table" class="table table-striped table-bordered dt-responsive nowrap w-100">
                <thead>
                    <tr>
                        <th class="text-center" width="40px">
                            <div class="form-check"><input type="checkbox" class="form-check-input" id="selectAll"></div>
                        </th>
                        <th>الرقم</th>
                        <th>اسم الحساب</th>
                        <th>رقم الحساب</th>
                        <th>الحساب الاب</th>
                        <th>نوع الحساب</th>
                        <th>الجهة</th>
                        <th>طبيعة الحساب</th>
                        <th style="width: 100px; text-align: center;">المزيد</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center">
                            <div class="form-check"><input type="checkbox" class="form-check-input employee-checkbox" value="1"></div>
                        </td>
                        <td>1</td>
                        <td>ركن الايمن بيلكوم</td>
                        <td>1001</td>
                        <td>الأصول</td>
                        <td>أصول</td>
                        <td>شركة</td>
                        <td>مدين</td>
                        <td style="text-align: center;">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    للمزيد
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" data-action="edit"><i class="ti ti-pencil me-1"></i> تعديل</a></li>
                                    <li><a class="dropdown-item" href="#" data-action="view"><i class="ti ti-eye me-1"></i> مشاهدة</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="ti ti-trash me-1"></i> حذف</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-center">
                            <div class="form-check"><input type="checkbox" class="form-check-input employee-checkbox" value="2"></div>
                        </td>
                        <td>2</td>
                        <td>تواصل بيلكوم</td>
                        <td>1002</td>
                        <td>الأصول</td>
                        <td>أصول</td>
                        <td>شركة</td>
                        <td>مدين</td>
                        <td style="text-align: center;">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    للمزيد
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" data-action="edit"><i class="ti ti-pencil me-1"></i> تعديل</a></li>
                                    <li><a class="dropdown-item" href="#" data-action="view"><i class="ti ti-eye me-1"></i> مشاهدة</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="ti ti-trash me-1"></i> حذف</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-center">
                            <div class="form-check"><input type="checkbox" class="form-check-input employee-checkbox" value="3"></div>
                        </td>
                        <td>3</td>
                        <td>المجد كاش</td>
                        <td>1003</td>
                        <td>الأصول</td>
                        <td>أصول</td>
                        <td>شركة</td>
                        <td>مدين</td>
                        <td style="text-align: center;">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    للمزيد
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" data-action="edit"><i class="ti ti-pencil me-1"></i> تعديل</a></li>
                                    <li><a class="dropdown-item" href="#" data-action="view"><i class="ti ti-eye me-1"></i> مشاهدة</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="ti ti-trash me-1"></i> حذف</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-center">
                            <div class="form-check"><input type="checkbox" class="form-check-input employee-checkbox" value="4"></div>
                        </td>
                        <td>4</td>
                        <td>البياض للاتصالات</td>
                        <td>1004</td>
                        <td>الأصول</td>
                        <td>أصول</td>
                        <td>شركة</td>
                        <td>مدين</td>
                        <td style="text-align: center;">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    للمزيد
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" data-action="edit"><i class="ti ti-pencil me-1"></i> تعديل</a></li>
                                    <li><a class="dropdown-item" href="#" data-action="view"><i class="ti ti-eye me-1"></i> مشاهدة</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="ti ti-trash me-1"></i> حذف</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-center">
                            <div class="form-check"><input type="checkbox" class="form-check-input employee-checkbox" value="5"></div>
                        </td>
                        <td>5</td>
                        <td>اتصالاتي</td>
                        <td>1005</td>
                        <td>الأصول</td>
                        <td>أصول</td>
                        <td>شركة</td>
                        <td>مدين</td>
                        <td style="text-align: center;">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    للمزيد
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" data-action="edit"><i class="ti ti-pencil me-1"></i> تعديل</a></li>
                                    <li><a class="dropdown-item" href="#" data-action="view"><i class="ti ti-eye me-1"></i> مشاهدة</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="ti ti-trash me-1"></i> حذف</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-center">
                            <div class="form-check"><input type="checkbox" class="form-check-input employee-checkbox" value="6"></div>
                        </td>
                        <td>6</td>
                        <td>صنعاء كاش</td>
                        <td>1006</td>
                        <td>الأصول</td>
                        <td>أصول</td>
                        <td>شركة</td>
                        <td>مدين</td>
                        <td style="text-align: center;">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    للمزيد
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" data-action="edit"><i class="ti ti-pencil me-1"></i> تعديل</a></li>
                                    <li><a class="dropdown-item" href="#" data-action="view"><i class="ti ti-eye me-1"></i> مشاهدة</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="ti ti-trash me-1"></i> حذف</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-center">
                            <div class="form-check"><input type="checkbox" class="form-check-input employee-checkbox" value="7"></div>
                        </td>
                        <td>7</td>
                        <td>شخصيه</td>
                        <td>1007</td>
                        <td>الأصول</td>
                        <td>أصول</td>
                        <td>شخص</td>
                        <td>مدين</td>
                        <td style="text-align: center;">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    للمزيد
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" data-action="edit"><i class="ti ti-pencil me-1"></i> تعديل</a></li>
                                    <li><a class="dropdown-item" href="#" data-action="view"><i class="ti ti-eye me-1"></i> مشاهدة</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="ti ti-trash me-1"></i> حذف</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="text-center">
                            <div class="form-check"><input type="checkbox" class="form-check-input employee-checkbox" value="8"></div>
                        </td>
                        <td>8</td>
                        <td>فوارق السداد</td>
                        <td>1008</td>
                        <td>الأصول</td>
                        <td>أصول</td>
                        <td>شركة</td>
                        <td>مدين</td>
                        <td style="text-align: center;">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    للمزيد
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" data-action="edit"><i class="ti ti-pencil me-1"></i> تعديل</a></li>
                                    <li><a class="dropdown-item" href="#" data-action="view"><i class="ti ti-eye me-1"></i> مشاهدة</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="ti ti-trash me-1"></i> حذف</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pagination -->
<div class="d-flex justify-content-center mt-3">
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true">‹</span>
                    <span>السابق</span>
                </a>
            </li>
            <li class="page-item active"><a class="page-link" href="#">1</a></li>
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Next">
                    <span>التالي</span>
                    <span aria-hidden="true">›</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

<!-- New Popup Menu Modal -->
<div class="modal fade" id="popupMenuModal" tabindex="-1" aria-labelledby="popupMenuModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 1200px;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="popupMenuModalLabel">قائمة الإجراءات</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Popup Menu Content -->
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <h6 class="text-primary">الإجراءات المتاحة</h6>
                            <p>اختر الإجراء الذي ترغب في تنفيذه من القائمة التالية:</p>
                        </div>
                    </div>
                    
                    <!-- Action Buttons Grid -->
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="ti ti-user-plus fs-1 text-primary mb-2"></i>
                                    <h6 class="card-title">إضافة حساب</h6>
                                    <p class="card-text">إضافة حساب جديد إلى النظام</p>
                                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#accountTreeAccountsModal">
                                        <i class="ti ti-plus"></i> إضافة
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="ti ti-file-export fs-1 text-success mb-2"></i>
                                    <h6 class="card-title">تصدير البيانات</h6>
                                    <p class="card-text">تصدير شجرة الحسابات إلى ملف</p>
                                    <button type="button" class="btn btn-success">
                                        <i class="ti ti-download"></i> تصدير
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="ti ti-printer fs-1 text-info mb-2"></i>
                                    <h6 class="card-title">طباعة التقارير</h6>
                                    <p class="card-text">طباعة تقارير الحسابات</p>
                                    <button type="button" class="btn btn-info">
                                        <i class="ti ti-printer"></i> طباعة
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="ti ti-search fs-1 text-warning mb-2"></i>
                                    <h6 class="card-title">بحث متقدم</h6>
                                    <p class="card-text">إجراء بحث متقدم في شجرة الحسابات</p>
                                    <button type="button" class="btn btn-warning">
                                        <i class="ti ti-filter"></i> بحث
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="ti ti-settings fs-1 text-secondary mb-2"></i>
                                    <h6 class="card-title">إعدادات النظام</h6>
                                    <p class="card-text">ضبط إعدادات شجرة الحسابات</p>
                                    <button type="button" class="btn btn-secondary">
                                        <i class="ti ti-settings"></i> إعدادات
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="ti ti-help fs-1 text-danger mb-2"></i>
                                    <h6 class="card-title">المساعدة</h6>
                                    <p class="card-text">عرض دليل المستخدم ومساعدة النظام</p>
                                    <button type="button" class="btn btn-danger">
                                        <i class="ti ti-help"></i> مساعدة
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Editing Account -->
<div class="modal fade" id="accountTreeEditAccountModal" tabindex="-1" aria-labelledby="accountTreeEditAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="accountTreeEditAccountModalLabel">تعديل بيانات الحساب</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Form Fields -->
                <form id="editAccountForm" method="post">
                    <input type="hidden" id="accountTreeEditAccountId" name="accountId">
                    
                    <!-- اسم المصدر الحسابي -->
                    <div class="mb-3">
                        <label class="form-label">اسم المصدر الحسابي <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="accountTreeEditAccountName" name="accountName" required>
                    </div>

                    <!-- رقم الحساب -->
                    <div class="mb-3">
                        <label class="form-label">رقم الحساب (اختياري)</label>
                        <input type="text" class="form-control" id="accountTreeEditAccountCode" name="accountCode">
                        <div class="alert alert-light border p-2">
                            <strong>ملاحظة:</strong> للحسابات التالية، حط الرقم الموضح (1101- عمولات الإدارة من مبيعات كروت الوايرلس، 1102- عمولات الإدارة من مبيعات التاجر، 11001 - حساب الكريمي، 11055 - حساب التأمينات بواسطة روبوت (تغذية المزودين)، 1108 - عمولات الإدارة من مبيعات الكهرباء، 10001 - حساب العملاء والوكلاء الأب، 10002 - حساب المزودين | الموردين الأب، 12003 - حساب الأب الإيرادات (مهم لتقرير الأرباح والخسائر)، 12004 - حساب الأب المصروفات (مهم لتقرير الأرباح والخسائر)، 41120 - حساب فوارق السداد (يضاف في قسم الإيرادات)، 41121 - حساب فوارق السداد الشمال والجنوب)
                        </div>
                    </div>

                    <!-- الحساب الأب -->
                    <div class="mb-3">
                        <label class="form-label">الحساب الاب <span class="text-danger">*</span></label>
                        <select class="form-select" id="accountTreeEditParentAccount" name="parentAccount">
                            <option value="" selected>اختر حساب الأب</option>
                            <option value="1">الأصول</option>
                            <option value="2">الخصوم</option>
                            <option value="3">حقوق الملكية</option>
                        </select>
                    </div>

                    <!-- جهة الحساب -->
                    <div class="mb-3">
                        <label class="form-label">حدد جهة الحساب <span class="text-danger">*</span></label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="side" id="accountTreeEditSideNorth" value="north">
                                <label class="form-check-label" for="accountTreeEditSideNorth">شمال</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="side" id="accountTreeEditSideSouth" value="south">
                                <label class="form-check-label" for="accountTreeEditSideSouth">جنوب</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="side" id="accountTreeEditSideNone" value="none" checked>
                                <label class="form-check-label" for="accountTreeEditSideNone">بدون</label>
                            </div>
                        </div>
                    </div>

                    <!-- المجموعة -->
                    <div class="mb-3">
                        <label class="form-label">اختر المجموعة (اختياري)</label>
                        <select class="form-select" id="accountTreeEditGroup" name="group">
                            <option selected>اختر المجموعة</option>
                        </select>
                    </div>

                    <!-- الموظف -->
                    <div class="mb-3">
                        <label class="form-label">الموظف (اختياري)</label>
                        <select class="form-select" id="accountTreeEditEmployee" name="employee">
                            <option selected>اختر الموظف</option>
                        </select>
                        <div class="alert alert-light border p-2">
                            ملاحظة: اختيارك موظف للحساب يعني ذلك انه فقط من يستطيع التعامل مع الحساب بالإضافة للمدير
                        </div>
                    </div>

                    <!-- نوع الحساب -->
                    <div class="mb-3">
                        <label class="form-label">نوع الحساب <span class="text-danger">*</span></label>
                        <div class="alert alert-light border p-2">
                            (الحساب الرئيسي لا يمكن اختياره في السندات المالية، ويبقى حساب تصنيف أب يتأثر بالحسابات التابعة له. 
                            الحساب الفرعي لا يمكن تتفرع منه حسابات أخرى فقط من الحساب الرئيسي يمكن تفرع حسابات أخرى)
                        </div>
                        <div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="accountType" id="accountTreeEditAccountTypeMain" value="main">
                                <label class="form-check-label" for="accountTreeEditAccountTypeMain">حساب رئيسي</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="accountType" id="accountTreeEditAccountTypeSub" value="sub" checked>
                                <label class="form-check-label" for="accountTreeEditAccountTypeSub">حساب فرعي</label>
                            </div>
                        </div>
                    </div>

                    <!-- طبيعة الحساب -->
                    <div class="mb-3">
                        <label class="form-label">طبيعة الحساب <span class="text-danger">*</span></label>
                        <div class="alert alert-light border p-2">
                            عند الاقفال السنوي، سيتم نقل ارصدة حسابات الميزانية العمومية، ولا يتم نقل ارصدة حسابات الارباح والخسائر
                        </div>
                        <div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="nature" id="accountTreeEditNatureBalance" value="balance" checked>
                                <label class="form-check-label" for="accountTreeEditNatureBalance">ميزانية عمومية</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="nature" id="accountTreeEditNatureIncome" value="income">
                                <label class="form-check-label" for="accountTreeEditNatureIncome">أرباح وخسائر</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                <button type="button" class="btn btn-success" id="accountTreeSaveEditAccountBtn">حفظ التعديلات</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Viewing Account -->
<div class="modal fade" id="accountTreeViewAccountModal" tabindex="-1" aria-labelledby="accountTreeViewAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="accountTreeViewAccountModalLabel">عرض بيانات الحساب</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Account Information Display -->
                <div class="container-fluid">
                    <!-- اسم المصدر الحسابي -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">اسم المصدر الحسابي</label>
                        <div class="form-control-plaintext border rounded p-2 bg-light" id="accountTreeViewAccountName">
                            <!-- TODO: Replace with real account data from AJAX or server -->
                        </div>
                    </div>

                    <!-- رقم الحساب -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">رقم الحساب</label>
                        <div class="form-control-plaintext border rounded p-2 bg-light" id="accountTreeViewAccountCode">
                            <!-- TODO: Replace with real account data from AJAX or server -->
                        </div>
                        <div class="alert alert-light border p-2 mt-2">
                            <strong>ملاحظة:</strong> للحسابات التالية، حط الرقم الموضح (1101- عمولات الإدارة من مبيعات كروت الوايرلس، 1102- عمولات الإدارة من مبيعات التاجر، 11001 - حساب الكريمي، 11055 - حساب التأمينات بواسطة روبوت (تغذية المزودين)، 1108 - عمولات الإدارة من مبيعات الكهرباء، 10001 - حساب العملاء والوكلاء الأب، 10002 - حساب المزودين | الموردين الأب، 12003 - حساب الأب الإيرادات (مهم لتقرير الأرباح والخسائر)، 12004 - حساب الأب المصروفات (مهم لتقرير الأرباح والخسائر)، 41120 - حساب فوارق السداد (يضاف في قسم الإيرادات)، 41121 - حساب فوارق السداد الشمال والجنوب)
                        </div>
                    </div>

                    <!-- الحساب الأب -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">الحساب الاب</label>
                        <div class="form-control-plaintext border rounded p-2 bg-light" id="accountTreeViewParentAccount">
                            <!-- TODO: Replace with real account data from AJAX or server -->
                        </div>
                    </div>

                    <!-- جهة الحساب -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">جهة الحساب</label>
                        <div class="form-control-plaintext border rounded p-2 bg-light" id="accountTreeViewAccountSide">
                            <!-- TODO: Replace with real account data from AJAX or server -->
                        </div>
                    </div>

                    <!-- المجموعة -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">المجموعة</label>
                        <div class="form-control-plaintext border rounded p-2 bg-light" id="accountTreeViewGroup">
                            <!-- TODO: Replace with real account data from AJAX or server -->
                        </div>
                    </div>

                    <!-- الموظف -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">الموظف</label>
                        <div class="form-control-plaintext border rounded p-2 bg-light" id="accountTreeViewEmployee">
                            <!-- TODO: Replace with real account data from AJAX or server -->
                        </div>
                        <div class="alert alert-light border p-2 mt-2">
                            ملاحظة: اختيارك موظف للحساب يعني ذلك انه فقط من يستطيع التعامل مع الحساب بالإضافة للمدير
                        </div>
                    </div>

                    <!-- نوع الحساب -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">نوع الحساب</label>
                        <div class="form-control-plaintext border rounded p-2 bg-light" id="accountTreeViewAccountType">
                            <!-- TODO: Replace with real account data from AJAX or server -->
                        </div>
                        <div class="alert alert-light border p-2 mt-2">
                            (الحساب الرئيسي لا يمكن اختياره في السندات المالية، ويبقى حساب تصنيف أب يتأثر بالحسابات التابعة له. 
                            الحساب الفرعي لا يمكن تتفرع منه حسابات أخرى فقط من الحساب الرئيسي يمكن تفرع حسابات أخرى)
                        </div>
                    </div>

                    <!-- طبيعة الحساب -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">طبيعة الحساب</label>
                        <div class="form-control-plaintext border rounded p-2 bg-light" id="accountTreeViewAccountNature">
                            <!-- TODO: Replace with real account data from AJAX or server -->
                        </div>
                        <div class="alert alert-light border p-2 mt-2">
                            عند الاقفال السنوي، سيتم نقل ارصدة حسابات الميزانية العمومية، ولا يتم نقل ارصدة حسابات الارباح والخسائر
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                <button type="button" class="btn btn-primary" id="accountTreeEditFromViewBtn">
                    <i class="ti ti-pencil me-1"></i> تعديل
                </button>
                <button type="button" class="btn btn-info" id="accountTreePrintAccountBtn">
                    <i class="ti ti-printer me-1"></i> طباعة
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Accounts Modal - New Popup Window -->
<div class="modal fade" id="accountTreeAccountsModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title">الحسابات 2 &gt; شجرة الحسابات</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      
      <div class="modal-body">
        
        <!-- اسم المصدر الحسابي -->
        <div class="mb-3">
          <label class="form-label">اسم المصدر الحسابي <span class="text-danger">*</span></label>
          <input type="text" class="form-control">
        </div>

        <!-- رقم الحساب -->
        <div class="mb-3">
          <label class="form-label">رقم الحساب (اختياري)</label>
          <input type="text" class="form-control">
          <div class="alert alert-light border p-2">
            <strong>ملاحظة:</strong> للحسابات التالية، حط الرقم الموضح (1101- عمولات الإدارة من مبيعات كروت الوايرلس، 1102- عمولات الإدارة من مبيعات التاجر، 11001 - حساب الكريمي، 11055 - حساب التأمينات بواسطة روبوت (تغذية المزودين)، 1108 - عمولات الإدارة من مبيعات الكهرباء، 10001 - حساب العملاء والوكلاء الأب، 10002 - حساب المزودين | الموردين الأب، 12003 - حساب الأب الإيرادات (مهم لتقرير الأرباح والخسائر)، 12004 - حساب الأب المصروفات (مهم لتقرير الأرباح والخسائر)، 41120 - حساب فوارق السداد (يضاف في قسم الإيرادات)، 41121 - حساب فوارق السداد الشمال والجنوب)
          </div>
        </div>

        <!-- الحساب الأب -->
        <div class="mb-3">
          <label class="form-label">الحساب الاب <span class="text-danger">*</span></label>
          <select class="form-select">
            <option>اختر حساب الأب</option>
          </select>
        </div>

        <!-- جهة الحساب -->
        <div class="mb-3">
          <label class="form-label">حدد جهة الحساب <span class="text-danger">*</span></label>
          <div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="side" value="north">
              <label class="form-check-label">شمال</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="side" value="south">
              <label class="form-check-label">جنوب</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="side" value="none" checked>
              <label class="form-check-label">بدون</label>
            </div>
          </div>
        </div>

        <!-- المجموعة -->
        <div class="mb-3">
          <label class="form-label">اختر المجموعة (اختياري)</label>
          <select class="form-select">
            <option>اختر المجموعة</option>
          </select>
        </div>

        <!-- الموظف -->
        <div class="mb-3">
          <label class="form-label">الموظف (اختياري)</label>
          <select class="form-select">
            <option>اختر الموظف</option>
          </select>
          <div class="alert alert-light border p-2">
            ملاحظة: اختيارك موظف للحساب يعني ذلك انه فقط من يستطيع التعامل مع الحساب بالإضافة للمدير
          </div>
        </div>

        <!-- نوع الحساب -->
        <div class="mb-3">
          <label class="form-label">نوع الحساب <span class="text-danger">*</span></label>
          <div class="alert alert-light border p-2">
            (الحساب الرئيسي لا يمكن اختياره في السندات المالية، ويبقى حساب تصنيف أب يتأثر بالحسابات التابعة له. 
            الحساب الفرعي لا يمكن تتفرع منه حسابات أخرى فقط من الحساب الرئيسي يمكن تفرع حسابات أخرى)
          </div>
          <div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="accountType" value="main">
              <label class="form-check-label">حساب رئيسي</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="accountType" value="sub" checked>
              <label class="form-check-label">حساب فرعي</label>
            </div>
          </div>
        </div>

        <!-- طبيعة الحساب -->
        <div class="mb-3">
          <label class="form-label">طبيعة الحساب <span class="text-danger">*</span></label>
          <div class="alert alert-light border p-2">
            عند الاقفال السنوي، سيتم نقل ارصدة حسابات الميزانية العمومية، ولا يتم نقل ارصدة حسابات الارباح والخسائر
          </div>
          <div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="nature" value="balance" checked>
              <label class="form-check-label">ميزانية عمومية</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="nature" value="income">
              <label class="form-check-label">أرباح وخسائر</label>
            </div>
          </div>
        </div>

      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
        <button type="button" class="btn btn-success">حفظ</button>
      </div>
    </div>
  </div>
</div>

@section Scripts {
<!-- jstree plugin Js-->
<script src="~/plugins/jstree/jstree.min.js"></script>
<script src="~/js/account-tree.js"></script>

<script>
  $(function () {
    // Show debug message
    $('#debug-message').show();
    
    // Test jQuery
    if (typeof $ === 'undefined') {
        $('#debug-message').removeClass('alert-info').addClass('alert-danger')
            .text('jQuery لم يتم تحميله بشكل صحيح');
        return;
    } else {
        $('#debug-message').append('<br>jQuery تم تحميله بشكل صحيح');
    }
    
    // Handle filter toggle button
    $('#toggleFilters').on('click', function() {
        var filterSection = $('#filterSection');
        var icon = $(this).find('i');
        var textSpan = $('#toggleFiltersText');
        
        if (filterSection.is(':visible')) {
            // Hide the filter section
            filterSection.hide();
            icon.removeClass('ti-filter-off').addClass('ti-filter');
            textSpan.text('إظهار الفلترة');
        } else {
            // Show the filter section
            filterSection.show();
            icon.removeClass('ti-filter').addClass('ti-filter-off');
            textSpan.text('إخفاء الفلترة');
        }
    });
    
    // Initialize the tree view
    try {
        if (typeof $.fn.jstree === 'undefined') {
            $('#debug-message').removeClass('alert-info').addClass('alert-danger')
                .text('jstree plugin لم يتم تحميله بشكل صحيح');
            return;
        }
        
        $('#account-tree').jstree({
            core: {
                themes: {responsive: false},
                data: @Html.Raw(Json.Serialize(Model.TreeData))
            },
            plugins: ["types", "contextmenu"],
            types: {
                default: {icon: "ti ti-folder-filled fs-lg text-warning"},
                file: {icon: "ti ti-file-text fs-lg text-primary"}
            },
            contextmenu: {
                items: function(node) {
                    return {
                        "edit": {
                            "label": "تعديل",
                            "icon": "ti ti-pencil",
                            "action": function (obj) {
                                editAccount(node);
                            }
                        },
                        "view": {
                            "label": "مشاهدة",
                            "icon": "ti ti-eye",
                            "action": function (obj) {
                                viewAccount(node);
                            }
                        },
                        "delete": {
                            "label": "حذف",
                            "icon": "ti ti-trash",
                            "action": function (obj) {
                                deleteAccount(node);
                            }
                        }
                    };
                }
            }
        }).on('ready.jstree', function() {
            $('#debug-message').append('<br>jstree تم تهيئة الشجرة بشكل صحيح');
        }).on('error.jstree', function(e, data) {
            console.error('jstree error:', data);
            $('#debug-message').removeClass('alert-info').addClass('alert-danger')
                .text('حدث خطأ أثناء تهيئة jstree: ' + data.reason);
        });
    } catch (error) {
        console.error('Error initializing jstree:', error);
        $('#debug-message').removeClass('alert-info').addClass('alert-danger')
            .text('حدث خطأ أثناء تحميل شجرة الحسابات: ' + error.message);
    }
    
    // Handle reset filters button
    $('#resetFilters').on('click', function() {
        // Reset all filter input fields
        $('#filter-name').val('');
        $('#filter-phone').val('');
        $('#filter-account').val('');
        alert('تم إعادة تعيين الفلاتر');
    });
    
    // Handle apply filters button
    $('#applyFilters').on('click', function() {
        // Get filter values
        var name = $('#filter-name').val();
        var phone = $('#filter-phone').val();
        var account = $('#filter-account').val();
        
        // In a real application, you would apply these filters to the data
        console.log('Applying filters:', { name: name, phone: phone, account: account });
        alert('تم تطبيق الفلاتر');
    });
  });
</script>
}